Небольшое пояснение:
http://jrgreez.ru/База лежит в \framework\data\
Пароли пользователей лежат в корне в тхт файле.
По основным моментам:
В app:init происходит Users::init(), который забирает коризину информацию о пользователе (если зареган, по ид) и его корзину (по коду сессии, если не зареган, по ид пользователя, если зареган. забирает не зактырый заказ), если нет корзины - создает новую и пишет инфу в сессию.
Сессия уходит в глобалы твига, чтобы можно было проверять на страницах группу пользователя и тд.
Дальше парсится урл. Избавляться от path было лень, как нибудь потом сделаю.
Если контроллер или метод не найден - выдает 404. (можно глянуть на примере каталог-акции).+кидает в консоль код ошибки.
Если в урле есть asAjax - то вызывает метод и отдает от него данные.
Причем аякс передается в обертке как массив из имен и значений, вручную перебираю его в имя-значение.
Потом для всех страниц (чтобы можно было в любой подключить модуль просмотренных) берутся топ5 товары, которые пользователь посмотрел (кликнул на детально).
Он иклюдится из templates/goods/includes
Вообще католагизация у меня контроллер/метод
И контроллер/includes/name
Чтобы можно было подключать модульно, например так список заказов, карточки товаров итд.
Потом ставится сессия страниц. Каждая уникальная страница пишется в сессию со всеми парамтерами, а страницы "детально" товаров пишуются в базу (вообще можно логирование подключить или все страницы писать, не знаю).
Далее пишется текущая страница для навигации.
Ну потом вьюхи вызываются итд.
Мелочи:
При оформлении заказа корзина создается новая. Если пользователь был зареган во время оформления заказа, то его заказу присваевается ид нового пользователя, а потом только создается новая корзина. (правильность создания и проверки корзин и заказов занали больше вего времени).
PS:
Веб-версия доступна все по той же ссылке: 